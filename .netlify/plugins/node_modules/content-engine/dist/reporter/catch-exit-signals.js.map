{"version":3,"file":"catch-exit-signals.js","names":["interruptActivities","activities","getStore","getState","logs","Object","keys","forEach","activityId","activity","status","ActivityStatuses","InProgress","NotStarted","reporter","completeActivity","Interrupted","prematureEnd","createPendingActivity","id","Failed","catchExitSignals","signalExit","code","signal"],"sources":["../../src/reporter/catch-exit-signals.ts"],"sourcesContent":["/*\n * This module is used to catch if the user kills the gatsby process via cmd+c\n * When this happens, there is some clean up logic we need to fire offf\n */\nimport signalExit from \"signal-exit\"\nimport { getStore } from \"./redux\"\nimport { createPendingActivity } from \"./redux/actions\"\nimport { ActivityStatuses } from \"./constants\"\nimport { reporter } from \"./reporter\"\n\nconst interruptActivities = (): void => {\n  const { activities } = getStore().getState().logs\n  Object.keys(activities).forEach(activityId => {\n    const activity = activities[activityId]\n    if (\n      activity.status === ActivityStatuses.InProgress ||\n      activity.status === ActivityStatuses.NotStarted\n    ) {\n      reporter.completeActivity(activityId, ActivityStatuses.Interrupted)\n    }\n  })\n}\n\nexport const prematureEnd = (): void => {\n  // hack so at least one activity is surely failed, so\n  // we are guaranteed to generate FAILED status\n  // if none of activity did explicitly fail\n  createPendingActivity({\n    id: `panic`,\n    status: ActivityStatuses.Failed,\n  })\n\n  interruptActivities()\n}\n\nexport const catchExitSignals = (): void => {\n  signalExit((code, signal) => {\n    if (code !== 0 && signal !== `SIGINT` && signal !== `SIGTERM`)\n      prematureEnd()\n    else interruptActivities()\n  })\n}\n"],"mappings":";;;;;AAIA;AACA;AACA;AACA;AACA;AARA;AACA;AACA;AACA;;AAOA,MAAMA,mBAAmB,GAAG,MAAY;EACtC,MAAM;IAAEC;EAAW,CAAC,GAAG,IAAAC,eAAQ,GAAE,CAACC,QAAQ,EAAE,CAACC,IAAI;EACjDC,MAAM,CAACC,IAAI,CAACL,UAAU,CAAC,CAACM,OAAO,CAACC,UAAU,IAAI;IAC5C,MAAMC,QAAQ,GAAGR,UAAU,CAACO,UAAU,CAAC;IACvC,IACEC,QAAQ,CAACC,MAAM,KAAKC,2BAAgB,CAACC,UAAU,IAC/CH,QAAQ,CAACC,MAAM,KAAKC,2BAAgB,CAACE,UAAU,EAC/C;MACAC,kBAAQ,CAACC,gBAAgB,CAACP,UAAU,EAAEG,2BAAgB,CAACK,WAAW,CAAC;IACrE;EACF,CAAC,CAAC;AACJ,CAAC;AAEM,MAAMC,YAAY,GAAG,MAAY;EACtC;EACA;EACA;EACA,IAAAC,8BAAqB,EAAC;IACpBC,EAAE,EAAG,OAAM;IACXT,MAAM,EAAEC,2BAAgB,CAACS;EAC3B,CAAC,CAAC;EAEFpB,mBAAmB,EAAE;AACvB,CAAC;AAAA;AAEM,MAAMqB,gBAAgB,GAAG,MAAY;EAC1C,IAAAC,mBAAU,EAAC,CAACC,IAAI,EAAEC,MAAM,KAAK;IAC3B,IAAID,IAAI,KAAK,CAAC,IAAIC,MAAM,KAAM,QAAO,IAAIA,MAAM,KAAM,SAAQ,EAC3DP,YAAY,EAAE,MACXjB,mBAAmB,EAAE;EAC5B,CAAC,CAAC;AACJ,CAAC;AAAA"}