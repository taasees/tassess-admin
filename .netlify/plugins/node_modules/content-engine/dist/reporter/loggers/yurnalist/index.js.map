{"version":3,"file":"index.js","names":["initializeYurnalistLogger","activities","yurnalist","createReporter","emoji","verbose","levelToYurnalist","LogLevels","Log","log","bind","Warning","warn","Error","error","Info","info","Success","success","Debug","ActivityLogLevels","Failed","text","chalk","red","Interrupted","gray","onLogAction","action","type","Actions","yurnalistMethod","payload","level","process","stdout","write","message","duration","toFixed","statusText","StartActivity","ActivityTypes","Spinner","spinner","activity","tick","update","id","end","Progress","bar","ProgressBar","total","Math","max","width","clear","current","undefined","curr","UpdateActivity","EndActivity"],"sources":["../../../../src/reporter/loggers/yurnalist/index.ts"],"sourcesContent":["import { onLogAction } from \"../../redux\"\nimport {\n  Actions,\n  LogLevels,\n  ActivityLogLevels,\n  ActivityTypes,\n} from \"../../constants\"\n\nimport { createReporter } from \"yurnalist\"\nimport ProgressBar from \"progress\"\nimport chalk from \"chalk\"\nimport { IUpdateActivity } from \"../../redux/types\"\n\ninterface IYurnalistActivities {\n  [activityId: string]: {\n    text: string | undefined\n    statusText: string | undefined\n    update(payload: IUpdateActivity[\"payload\"]): void\n    end(): void\n  }\n}\n\nexport function initializeYurnalistLogger(): void {\n  const activities: IYurnalistActivities = {}\n  const yurnalist = createReporter({ emoji: true, verbose: true })\n\n  const levelToYurnalist = {\n    [LogLevels.Log]: yurnalist.log.bind(yurnalist),\n    [LogLevels.Warning]: yurnalist.warn.bind(yurnalist),\n    [LogLevels.Error]: yurnalist.error.bind(yurnalist),\n    [LogLevels.Info]: yurnalist.info.bind(yurnalist),\n    [LogLevels.Success]: yurnalist.success.bind(yurnalist),\n    [LogLevels.Debug]: yurnalist.verbose.bind(yurnalist),\n    [ActivityLogLevels.Success]: yurnalist.success.bind(yurnalist),\n    [ActivityLogLevels.Failed]: (text: string): void => {\n      yurnalist.log(`${chalk.red(`failed`)} ${text}`)\n    },\n    [ActivityLogLevels.Interrupted]: (text: string): void => {\n      yurnalist.log(`${chalk.gray(`not finished`)} ${text}`)\n    },\n  }\n\n  onLogAction(action => {\n    switch (action.type) {\n      case Actions.Log: {\n        const yurnalistMethod = levelToYurnalist[action.payload.level]\n        if (!yurnalistMethod) {\n          process.stdout.write(`NO \"${action.payload.level}\" method\\n`)\n        } else {\n          let message = action.payload.text\n          if (action.payload.duration) {\n            message += ` - ${action.payload.duration.toFixed(3)}s`\n          }\n          if (action.payload.statusText) {\n            message += ` - ${action.payload.statusText}`\n          }\n          yurnalistMethod(message)\n        }\n\n        break\n      }\n      case Actions.StartActivity: {\n        if (action.payload.type === ActivityTypes.Spinner) {\n          const spinner = yurnalist.activity()\n          spinner.tick(action.payload.text)\n\n          const activity = {\n            text: action.payload.text,\n            statusText: action.payload.statusText,\n            update(payload: any): void {\n              // TODO: I'm not convinced that this is ever called with a text property.\n              // From searching the codebase it appears that we do not ever assign a text\n              // property during the IUpdateActivity action.\n              if (payload.text) {\n                activity.text = payload.text\n              }\n              if (payload.statusText) {\n                activity.statusText = payload.statusText\n              }\n\n              let message = activity.text\n              if (activity.statusText) {\n                message += ` - ${activity.statusText}`\n              }\n\n              message += ` id:\"${action.payload.id}\"`\n\n              spinner.tick(message)\n            },\n            end(): void {\n              spinner.end()\n            },\n          }\n          activities[action.payload.id] = activity\n        } else if (action.payload.type === ActivityTypes.Progress) {\n          const bar = new ProgressBar(\n            ` [:bar] :current/:total :elapsed s :rate /s :percent ${action.payload.text}`,\n            {\n              total: Math.max(action.payload.total || 1, 1) || 1, // Not zero. Otherwise you get 0/0 errors.\n              // curr: action.payload.current, // see below\n              width: 30,\n              clear: true,\n            }\n          )\n\n          // There is a bug in the `progress` package where the timer doesn't\n          // start until the first tick and setting `curr` will cause the\n          // time/eta to remain zero: https://github.com/visionmedia/node-progress/issues/81\n          // This is a workaround although the eta will initially be wrong\n          // until it settles, if starting at non-zero.\n          if (\n            typeof action.payload.current === `number` &&\n            action.payload.current >= 0\n          ) {\n            bar.tick(action.payload.current)\n          }\n\n          activities[action.payload.id] = {\n            text: undefined,\n            statusText: undefined,\n            update(payload): void {\n              if (payload.total) {\n                bar.total = payload.total\n              }\n              if (payload.current) {\n                bar.curr = payload.current\n              }\n\n              bar.tick(0)\n            },\n            end(): void {},\n          }\n        }\n        break\n      }\n      case Actions.UpdateActivity: {\n        const activity = activities[action.payload.id]\n        if (activity) {\n          activity.update(action.payload)\n        }\n        break\n      }\n      case Actions.EndActivity: {\n        const activity = activities[action.payload.id]\n        if (activity) {\n          activity.end()\n          delete activities[action.payload.id]\n        }\n        break\n      }\n    }\n  })\n}\n"],"mappings":";;;;;AAAA;AACA;AAOA;AACA;AACA;AAYO,SAASA,yBAAyB,GAAS;EAChD,MAAMC,UAAgC,GAAG,CAAC,CAAC;EAC3C,MAAMC,SAAS,GAAG,IAAAC,yBAAc,EAAC;IAAEC,KAAK,EAAE,IAAI;IAAEC,OAAO,EAAE;EAAK,CAAC,CAAC;EAEhE,MAAMC,gBAAgB,GAAG;IACvB,CAACC,oBAAS,CAACC,GAAG,GAAGN,SAAS,CAACO,GAAG,CAACC,IAAI,CAACR,SAAS,CAAC;IAC9C,CAACK,oBAAS,CAACI,OAAO,GAAGT,SAAS,CAACU,IAAI,CAACF,IAAI,CAACR,SAAS,CAAC;IACnD,CAACK,oBAAS,CAACM,KAAK,GAAGX,SAAS,CAACY,KAAK,CAACJ,IAAI,CAACR,SAAS,CAAC;IAClD,CAACK,oBAAS,CAACQ,IAAI,GAAGb,SAAS,CAACc,IAAI,CAACN,IAAI,CAACR,SAAS,CAAC;IAChD,CAACK,oBAAS,CAACU,OAAO,GAAGf,SAAS,CAACgB,OAAO,CAACR,IAAI,CAACR,SAAS,CAAC;IACtD,CAACK,oBAAS,CAACY,KAAK,GAAGjB,SAAS,CAACG,OAAO,CAACK,IAAI,CAACR,SAAS,CAAC;IACpD,CAACkB,4BAAiB,CAACH,OAAO,GAAGf,SAAS,CAACgB,OAAO,CAACR,IAAI,CAACR,SAAS,CAAC;IAC9D,CAACkB,4BAAiB,CAACC,MAAM,GAAIC,IAAY,IAAW;MAClDpB,SAAS,CAACO,GAAG,CAAE,GAAEc,cAAK,CAACC,GAAG,CAAE,QAAO,CAAE,IAAGF,IAAK,EAAC,CAAC;IACjD,CAAC;IACD,CAACF,4BAAiB,CAACK,WAAW,GAAIH,IAAY,IAAW;MACvDpB,SAAS,CAACO,GAAG,CAAE,GAAEc,cAAK,CAACG,IAAI,CAAE,cAAa,CAAE,IAAGJ,IAAK,EAAC,CAAC;IACxD;EACF,CAAC;EAED,IAAAK,kBAAW,EAACC,MAAM,IAAI;IACpB,QAAQA,MAAM,CAACC,IAAI;MACjB,KAAKC,kBAAO,CAACtB,GAAG;QAAE;UAChB,MAAMuB,eAAe,GAAGzB,gBAAgB,CAACsB,MAAM,CAACI,OAAO,CAACC,KAAK,CAAC;UAC9D,IAAI,CAACF,eAAe,EAAE;YACpBG,OAAO,CAACC,MAAM,CAACC,KAAK,CAAE,OAAMR,MAAM,CAACI,OAAO,CAACC,KAAM,YAAW,CAAC;UAC/D,CAAC,MAAM;YACL,IAAII,OAAO,GAAGT,MAAM,CAACI,OAAO,CAACV,IAAI;YACjC,IAAIM,MAAM,CAACI,OAAO,CAACM,QAAQ,EAAE;cAC3BD,OAAO,IAAK,MAAKT,MAAM,CAACI,OAAO,CAACM,QAAQ,CAACC,OAAO,CAAC,CAAC,CAAE,GAAE;YACxD;YACA,IAAIX,MAAM,CAACI,OAAO,CAACQ,UAAU,EAAE;cAC7BH,OAAO,IAAK,MAAKT,MAAM,CAACI,OAAO,CAACQ,UAAW,EAAC;YAC9C;YACAT,eAAe,CAACM,OAAO,CAAC;UAC1B;UAEA;QACF;MACA,KAAKP,kBAAO,CAACW,aAAa;QAAE;UAC1B,IAAIb,MAAM,CAACI,OAAO,CAACH,IAAI,KAAKa,wBAAa,CAACC,OAAO,EAAE;YACjD,MAAMC,OAAO,GAAG1C,SAAS,CAAC2C,QAAQ,EAAE;YACpCD,OAAO,CAACE,IAAI,CAAClB,MAAM,CAACI,OAAO,CAACV,IAAI,CAAC;YAEjC,MAAMuB,QAAQ,GAAG;cACfvB,IAAI,EAAEM,MAAM,CAACI,OAAO,CAACV,IAAI;cACzBkB,UAAU,EAAEZ,MAAM,CAACI,OAAO,CAACQ,UAAU;cACrCO,MAAM,CAACf,OAAY,EAAQ;gBACzB;gBACA;gBACA;gBACA,IAAIA,OAAO,CAACV,IAAI,EAAE;kBAChBuB,QAAQ,CAACvB,IAAI,GAAGU,OAAO,CAACV,IAAI;gBAC9B;gBACA,IAAIU,OAAO,CAACQ,UAAU,EAAE;kBACtBK,QAAQ,CAACL,UAAU,GAAGR,OAAO,CAACQ,UAAU;gBAC1C;gBAEA,IAAIH,OAAO,GAAGQ,QAAQ,CAACvB,IAAI;gBAC3B,IAAIuB,QAAQ,CAACL,UAAU,EAAE;kBACvBH,OAAO,IAAK,MAAKQ,QAAQ,CAACL,UAAW,EAAC;gBACxC;gBAEAH,OAAO,IAAK,QAAOT,MAAM,CAACI,OAAO,CAACgB,EAAG,GAAE;gBAEvCJ,OAAO,CAACE,IAAI,CAACT,OAAO,CAAC;cACvB,CAAC;cACDY,GAAG,GAAS;gBACVL,OAAO,CAACK,GAAG,EAAE;cACf;YACF,CAAC;YACDhD,UAAU,CAAC2B,MAAM,CAACI,OAAO,CAACgB,EAAE,CAAC,GAAGH,QAAQ;UAC1C,CAAC,MAAM,IAAIjB,MAAM,CAACI,OAAO,CAACH,IAAI,KAAKa,wBAAa,CAACQ,QAAQ,EAAE;YACzD,MAAMC,GAAG,GAAG,IAAIC,iBAAW,CACxB,wDAAuDxB,MAAM,CAACI,OAAO,CAACV,IAAK,EAAC,EAC7E;cACE+B,KAAK,EAAEC,IAAI,CAACC,GAAG,CAAC3B,MAAM,CAACI,OAAO,CAACqB,KAAK,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC;cAAE;cACpD;cACAG,KAAK,EAAE,EAAE;cACTC,KAAK,EAAE;YACT,CAAC,CACF;;YAED;YACA;YACA;YACA;YACA;YACA,IACE,OAAO7B,MAAM,CAACI,OAAO,CAAC0B,OAAO,KAAM,QAAO,IAC1C9B,MAAM,CAACI,OAAO,CAAC0B,OAAO,IAAI,CAAC,EAC3B;cACAP,GAAG,CAACL,IAAI,CAAClB,MAAM,CAACI,OAAO,CAAC0B,OAAO,CAAC;YAClC;YAEAzD,UAAU,CAAC2B,MAAM,CAACI,OAAO,CAACgB,EAAE,CAAC,GAAG;cAC9B1B,IAAI,EAAEqC,SAAS;cACfnB,UAAU,EAAEmB,SAAS;cACrBZ,MAAM,CAACf,OAAO,EAAQ;gBACpB,IAAIA,OAAO,CAACqB,KAAK,EAAE;kBACjBF,GAAG,CAACE,KAAK,GAAGrB,OAAO,CAACqB,KAAK;gBAC3B;gBACA,IAAIrB,OAAO,CAAC0B,OAAO,EAAE;kBACnBP,GAAG,CAACS,IAAI,GAAG5B,OAAO,CAAC0B,OAAO;gBAC5B;gBAEAP,GAAG,CAACL,IAAI,CAAC,CAAC,CAAC;cACb,CAAC;cACDG,GAAG,GAAS,CAAC;YACf,CAAC;UACH;UACA;QACF;MACA,KAAKnB,kBAAO,CAAC+B,cAAc;QAAE;UAC3B,MAAMhB,QAAQ,GAAG5C,UAAU,CAAC2B,MAAM,CAACI,OAAO,CAACgB,EAAE,CAAC;UAC9C,IAAIH,QAAQ,EAAE;YACZA,QAAQ,CAACE,MAAM,CAACnB,MAAM,CAACI,OAAO,CAAC;UACjC;UACA;QACF;MACA,KAAKF,kBAAO,CAACgC,WAAW;QAAE;UACxB,MAAMjB,QAAQ,GAAG5C,UAAU,CAAC2B,MAAM,CAACI,OAAO,CAACgB,EAAE,CAAC;UAC9C,IAAIH,QAAQ,EAAE;YACZA,QAAQ,CAACI,GAAG,EAAE;YACd,OAAOhD,UAAU,CAAC2B,MAAM,CAACI,OAAO,CAACgB,EAAE,CAAC;UACtC;UACA;QACF;IAAC;EAEL,CAAC,CAAC;AACJ"}