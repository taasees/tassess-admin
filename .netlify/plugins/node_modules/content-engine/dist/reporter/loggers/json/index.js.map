{"version":3,"file":"index.js","names":["isStringPayload","action","payload","sanitizeAction","copiedAction","text","stripAnsi","statusText","initializeJSONLogger","onLogAction","sanitizedAction","process","stdout","write","JSON","stringify"],"sources":["../../../../src/reporter/loggers/json/index.ts"],"sourcesContent":["import { onLogAction } from \"../../redux/index\"\nimport { ActionsUnion, ISetStatus } from \"../../redux/types\"\nimport stripAnsi from \"strip-ansi\"\nimport { cloneDeep } from \"lodash\"\n\nconst isStringPayload = (action: ActionsUnion): action is ISetStatus =>\n  typeof action.payload === `string`\n\nconst sanitizeAction = (action: ActionsUnion): ActionsUnion => {\n  const copiedAction = cloneDeep(action)\n\n  if (isStringPayload(copiedAction)) {\n    return copiedAction\n  }\n\n  if (`text` in copiedAction.payload && copiedAction.payload.text) {\n    copiedAction.payload.text = stripAnsi(copiedAction.payload.text)\n  }\n  if (`statusText` in copiedAction.payload && copiedAction.payload.statusText) {\n    copiedAction.payload.statusText = stripAnsi(copiedAction.payload.statusText)\n  }\n\n  return copiedAction\n}\n\nexport function initializeJSONLogger(): void {\n  onLogAction((action: ActionsUnion) => {\n    const sanitizedAction = sanitizeAction(action)\n\n    process.stdout.write(JSON.stringify(sanitizedAction) + `\\n`)\n  })\n}\n"],"mappings":";;;;;;AAAA;AAEA;AAGA,MAAMA,eAAe,GAAIC,MAAoB,IAC3C,OAAOA,MAAM,CAACC,OAAO,KAAM,QAAO;AAEpC,MAAMC,cAAc,GAAIF,MAAoB,IAAmB;EAC7D,MAAMG,YAAY,GAAG,yBAAUH,MAAM,CAAC;EAEtC,IAAID,eAAe,CAACI,YAAY,CAAC,EAAE;IACjC,OAAOA,YAAY;EACrB;EAEA,IAAK,MAAK,IAAIA,YAAY,CAACF,OAAO,IAAIE,YAAY,CAACF,OAAO,CAACG,IAAI,EAAE;IAC/DD,YAAY,CAACF,OAAO,CAACG,IAAI,GAAG,IAAAC,kBAAS,EAACF,YAAY,CAACF,OAAO,CAACG,IAAI,CAAC;EAClE;EACA,IAAK,YAAW,IAAID,YAAY,CAACF,OAAO,IAAIE,YAAY,CAACF,OAAO,CAACK,UAAU,EAAE;IAC3EH,YAAY,CAACF,OAAO,CAACK,UAAU,GAAG,IAAAD,kBAAS,EAACF,YAAY,CAACF,OAAO,CAACK,UAAU,CAAC;EAC9E;EAEA,OAAOH,YAAY;AACrB,CAAC;AAEM,SAASI,oBAAoB,GAAS;EAC3C,IAAAC,kBAAW,EAAER,MAAoB,IAAK;IACpC,MAAMS,eAAe,GAAGP,cAAc,CAACF,MAAM,CAAC;IAE9CU,OAAO,CAACC,MAAM,CAACC,KAAK,CAACC,IAAI,CAACC,SAAS,CAACL,eAAe,CAAC,GAAI,IAAG,CAAC;EAC9D,CAAC,CAAC;AACJ"}