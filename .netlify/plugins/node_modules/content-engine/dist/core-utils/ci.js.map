{"version":3,"file":"ci.js","names":["CI_DEFINITIONS","getEnvDetect","key","name","envFromCIAndCIName","herokuDetect","getEnvFromCIInfo","envFromCIWithNoName","lookupCI","fn","res","e","CIName","isCI","getCIName","ci","process","env","NODE","test","CI_NAME","CI"],"sources":["../../src/core-utils/ci.ts"],"sourcesContent":["import ci from \"ci-info\"\n\nconst CI_DEFINITIONS = [\n  getEnvDetect({ key: `NOW_BUILDER_ANNOTATE`, name: `ZEIT Now` }),\n  getEnvDetect({ key: `NOW_REGION`, name: `ZEIT Now v1` }),\n  getEnvDetect({ key: `VERCEL_URL`, name: `Vercel Now` }),\n  getEnvDetect({ key: `NOW_BUILDER`, name: `Vercel Now` }),\n  getEnvDetect({ key: `VERCEL_BUILDER`, name: `Vercel Now` }),\n  getEnvDetect({ key: `CODESANDBOX_SSE`, name: `CodeSandbox` }),\n  getEnvDetect({ key: `GITHUB_ACTIONS`, name: `GitHub Actions` }),\n  getEnvDetect({ key: `CIRCLE_BRANCH`, name: `CircleCI` }),\n  getEnvDetect({ key: `CIRCLECI`, name: `CircleCI` }),\n  envFromCIAndCIName,\n  herokuDetect,\n  getEnvFromCIInfo,\n  envFromCIWithNoName,\n]\n\nfunction lookupCI(): string | null {\n  for (const fn of CI_DEFINITIONS) {\n    try {\n      const res = fn()\n      if (res) {\n        return res\n      }\n    } catch (e) {\n      // ignore\n    }\n  }\n  return null\n}\nconst CIName = lookupCI()\n\n/**\n * Determines whether the environment where the code is running is in CI\n * @return true if the environment is in CI, false otherwise\n */\n\nexport function isCI(): boolean {\n  return !!CIName\n}\n\n/**\n * Gets the name of the CI environment (e.g. \"Vercel\", \"Heroku\", etc.)\n * @return The name of the CI if available. Defaults to null if not in CI\n */\n\nexport function getCIName(): string | null {\n  if (!isCI()) {\n    return null\n  }\n  return CIName\n}\n\nfunction getEnvFromCIInfo(): string | null {\n  if (ci.isCI) return ci.name || `ci-info detected w/o name`\n  return null\n}\n\nfunction getEnvDetect({\n  key,\n  name,\n}: {\n  key: string\n  name: string\n}): () => string | null {\n  return function (): string | null {\n    if (process.env[key]) {\n      return name\n    }\n    return null\n  }\n}\n\nfunction herokuDetect(): false | \"Heroku\" {\n  return (\n    typeof process.env.NODE === `string` &&\n    /\\.heroku\\/node\\/bin\\/node/.test(process.env.NODE) &&\n    `Heroku`\n  )\n}\n\nfunction envFromCIAndCIName(): string | null {\n  if (process.env.CI_NAME && process.env.CI) {\n    return process.env.CI_NAME\n  }\n  return null\n}\n\nfunction envFromCIWithNoName(): \"CI detected without name\" | null {\n  if (process.env.CI) {\n    return `CI detected without name`\n  }\n  return null\n}\n"],"mappings":";;;;;;AAAA;AAEA,MAAMA,cAAc,GAAG,CACrBC,YAAY,CAAC;EAAEC,GAAG,EAAG,sBAAqB;EAAEC,IAAI,EAAG;AAAU,CAAC,CAAC,EAC/DF,YAAY,CAAC;EAAEC,GAAG,EAAG,YAAW;EAAEC,IAAI,EAAG;AAAa,CAAC,CAAC,EACxDF,YAAY,CAAC;EAAEC,GAAG,EAAG,YAAW;EAAEC,IAAI,EAAG;AAAY,CAAC,CAAC,EACvDF,YAAY,CAAC;EAAEC,GAAG,EAAG,aAAY;EAAEC,IAAI,EAAG;AAAY,CAAC,CAAC,EACxDF,YAAY,CAAC;EAAEC,GAAG,EAAG,gBAAe;EAAEC,IAAI,EAAG;AAAY,CAAC,CAAC,EAC3DF,YAAY,CAAC;EAAEC,GAAG,EAAG,iBAAgB;EAAEC,IAAI,EAAG;AAAa,CAAC,CAAC,EAC7DF,YAAY,CAAC;EAAEC,GAAG,EAAG,gBAAe;EAAEC,IAAI,EAAG;AAAgB,CAAC,CAAC,EAC/DF,YAAY,CAAC;EAAEC,GAAG,EAAG,eAAc;EAAEC,IAAI,EAAG;AAAU,CAAC,CAAC,EACxDF,YAAY,CAAC;EAAEC,GAAG,EAAG,UAAS;EAAEC,IAAI,EAAG;AAAU,CAAC,CAAC,EACnDC,kBAAkB,EAClBC,YAAY,EACZC,gBAAgB,EAChBC,mBAAmB,CACpB;AAED,SAASC,QAAQ,GAAkB;EACjC,KAAK,MAAMC,EAAE,IAAIT,cAAc,EAAE;IAC/B,IAAI;MACF,MAAMU,GAAG,GAAGD,EAAE,EAAE;MAChB,IAAIC,GAAG,EAAE;QACP,OAAOA,GAAG;MACZ;IACF,CAAC,CAAC,OAAOC,CAAC,EAAE;MACV;IAAA;EAEJ;EACA,OAAO,IAAI;AACb;AACA,MAAMC,MAAM,GAAGJ,QAAQ,EAAE;;AAEzB;AACA;AACA;AACA;;AAEO,SAASK,IAAI,GAAY;EAC9B,OAAO,CAAC,CAACD,MAAM;AACjB;;AAEA;AACA;AACA;AACA;;AAEO,SAASE,SAAS,GAAkB;EACzC,IAAI,CAACD,IAAI,EAAE,EAAE;IACX,OAAO,IAAI;EACb;EACA,OAAOD,MAAM;AACf;AAEA,SAASN,gBAAgB,GAAkB;EACzC,IAAIS,eAAE,CAACF,IAAI,EAAE,OAAOE,eAAE,CAACZ,IAAI,IAAK,2BAA0B;EAC1D,OAAO,IAAI;AACb;AAEA,SAASF,YAAY,CAAC;EACpBC,GAAG;EACHC;AAIF,CAAC,EAAuB;EACtB,OAAO,YAA2B;IAChC,IAAIa,OAAO,CAACC,GAAG,CAACf,GAAG,CAAC,EAAE;MACpB,OAAOC,IAAI;IACb;IACA,OAAO,IAAI;EACb,CAAC;AACH;AAEA,SAASE,YAAY,GAAqB;EACxC,OACE,OAAOW,OAAO,CAACC,GAAG,CAACC,IAAI,KAAM,QAAO,IACpC,2BAA2B,CAACC,IAAI,CAACH,OAAO,CAACC,GAAG,CAACC,IAAI,CAAC,IACjD,QAAO;AAEZ;AAEA,SAASd,kBAAkB,GAAkB;EAC3C,IAAIY,OAAO,CAACC,GAAG,CAACG,OAAO,IAAIJ,OAAO,CAACC,GAAG,CAACI,EAAE,EAAE;IACzC,OAAOL,OAAO,CAACC,GAAG,CAACG,OAAO;EAC5B;EACA,OAAO,IAAI;AACb;AAEA,SAASb,mBAAmB,GAAsC;EAChE,IAAIS,OAAO,CAACC,GAAG,CAACI,EAAE,EAAE;IAClB,OAAQ,0BAAyB;EACnC;EACA,OAAO,IAAI;AACb"}