{"version":3,"file":"physical-cpu-count.js","names":["exec","command","output","childProcess","execSync","encoding","fallbackToNodeJSCheck","cores","os","cpus","filter","cpu","index","hasHyperthreading","model","includes","isOdd","length","getPhysicalCpuCount","platform","Number","trim","replace","split","map","line","value","isNaN","reduce","sum","number","err"],"sources":["../../src/core-utils/physical-cpu-count.ts"],"sourcesContent":["// Forked from physical-cpu-count package from npm\nimport os from \"os\"\nimport childProcess from \"child_process\"\n\nfunction exec(command: string): string {\n  const output = childProcess.execSync(command, { encoding: `utf8` })\n  return output\n}\n\n/*\n * Fallback if child process fails to receive CPU count\n */\nfunction fallbackToNodeJSCheck(): number {\n  const cores = os.cpus().filter(function (cpu, index) {\n    const hasHyperthreading = cpu.model.includes(`Intel`)\n    const isOdd = index % 2 === 1\n    return !hasHyperthreading || isOdd\n  })\n\n  return cores.length\n}\n\nexport function getPhysicalCpuCount(): number {\n  const platform = os.platform()\n  try {\n    if (platform === `linux`) {\n      const output = exec(\n        `lscpu -p | grep -E -v \"^#\" | sort -u -t, -k 2,4 | wc -l`\n      )\n      return Number(output.trim())\n    }\n\n    if (platform === `darwin`) {\n      const output = exec(`sysctl -n hw.physicalcpu_max`)\n      return Number(output.trim())\n    }\n\n    if (platform === `win32`) {\n      const output = exec(`WMIC CPU Get NumberOfCores`)\n      return output\n        .replace(/\\r/g, ``)\n        .split(`\\n`)\n        .map(line => Number(line))\n        .filter(value => !isNaN(value))\n        .reduce((sum, number) => sum + number, 0)\n    }\n  } catch (err) {\n    // carry on\n  }\n\n  return fallbackToNodeJSCheck()\n}\n"],"mappings":";;;;;AACA;AACA;AAFA;;AAIA,SAASA,IAAI,CAACC,OAAe,EAAU;EACrC,MAAMC,MAAM,GAAGC,sBAAY,CAACC,QAAQ,CAACH,OAAO,EAAE;IAAEI,QAAQ,EAAG;EAAM,CAAC,CAAC;EACnE,OAAOH,MAAM;AACf;;AAEA;AACA;AACA;AACA,SAASI,qBAAqB,GAAW;EACvC,MAAMC,KAAK,GAAGC,WAAE,CAACC,IAAI,EAAE,CAACC,MAAM,CAAC,UAAUC,GAAG,EAAEC,KAAK,EAAE;IACnD,MAAMC,iBAAiB,GAAGF,GAAG,CAACG,KAAK,CAACC,QAAQ,CAAE,OAAM,CAAC;IACrD,MAAMC,KAAK,GAAGJ,KAAK,GAAG,CAAC,KAAK,CAAC;IAC7B,OAAO,CAACC,iBAAiB,IAAIG,KAAK;EACpC,CAAC,CAAC;EAEF,OAAOT,KAAK,CAACU,MAAM;AACrB;AAEO,SAASC,mBAAmB,GAAW;EAC5C,MAAMC,QAAQ,GAAGX,WAAE,CAACW,QAAQ,EAAE;EAC9B,IAAI;IACF,IAAIA,QAAQ,KAAM,OAAM,EAAE;MACxB,MAAMjB,MAAM,GAAGF,IAAI,CAChB,yDAAwD,CAC1D;MACD,OAAOoB,MAAM,CAAClB,MAAM,CAACmB,IAAI,EAAE,CAAC;IAC9B;IAEA,IAAIF,QAAQ,KAAM,QAAO,EAAE;MACzB,MAAMjB,MAAM,GAAGF,IAAI,CAAE,8BAA6B,CAAC;MACnD,OAAOoB,MAAM,CAAClB,MAAM,CAACmB,IAAI,EAAE,CAAC;IAC9B;IAEA,IAAIF,QAAQ,KAAM,OAAM,EAAE;MACxB,MAAMjB,MAAM,GAAGF,IAAI,CAAE,4BAA2B,CAAC;MACjD,OAAOE,MAAM,CACVoB,OAAO,CAAC,KAAK,EAAG,EAAC,CAAC,CAClBC,KAAK,CAAE,IAAG,CAAC,CACXC,GAAG,CAACC,IAAI,IAAIL,MAAM,CAACK,IAAI,CAAC,CAAC,CACzBf,MAAM,CAACgB,KAAK,IAAI,CAACC,KAAK,CAACD,KAAK,CAAC,CAAC,CAC9BE,MAAM,CAAC,CAACC,GAAG,EAAEC,MAAM,KAAKD,GAAG,GAAGC,MAAM,EAAE,CAAC,CAAC;IAC7C;EACF,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZ;EAAA;EAGF,OAAOzB,qBAAqB,EAAE;AAChC"}