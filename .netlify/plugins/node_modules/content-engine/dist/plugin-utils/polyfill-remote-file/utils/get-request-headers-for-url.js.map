{"version":3,"file":"get-request-headers-for-url.js","names":["loggedWarning","process","env","NODE_ENV","getRequestHeadersForUrl","passedUrl","store","storeIsMissing","console","warn","undefined","baseDomain","url","parse","hostname","requestHeaders","getState","get"],"sources":["../../../../src/plugin-utils/polyfill-remote-file/utils/get-request-headers-for-url.ts"],"sourcesContent":["import url from \"url\"\n\nimport type { Headers } from \"got\"\nimport type { Store } from \"../../../types\"\n\n// in tests we don't want to log the warning\nlet loggedWarning = process.env.NODE_ENV === `test`\n\nexport function getRequestHeadersForUrl(\n  passedUrl: string,\n  store?: Store\n): Headers | undefined {\n  const storeIsMissing = !store || !(`getState` in store)\n\n  if (storeIsMissing && !loggedWarning) {\n    loggedWarning = true\n    console.warn(\n      `Gatsby's redux store is required in the \"addRemoteFilePolyfillInterface\" and \"polyfillImageServiceDevRoutes\" API's for image CDN. No store was found when requesting url \"${passedUrl}\". This will fail your build in Gatsby V5. Upgrade your source plugins and Gatsby packages to the latest versions to resolve this. If you are a source plugin author visit https://gatsby.dev/source-plugins-image-cdn to learn how to make this warning go away.`\n    )\n  }\n\n  if (storeIsMissing) {\n    return undefined\n  }\n\n  const baseDomain = url.parse(passedUrl).hostname\n\n  // @ts-ignore todo type store\n  const { requestHeaders } = store.getState()\n\n  return baseDomain ? requestHeaders?.get(baseDomain) : undefined\n}\n"],"mappings":";;;;;AAAA;AAKA;AACA,IAAIA,aAAa,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAM,MAAK;AAE5C,SAASC,uBAAuB,CACrCC,SAAiB,EACjBC,KAAa,EACQ;EACrB,MAAMC,cAAc,GAAG,CAACD,KAAK,IAAI,EAAG,UAAS,IAAIA,KAAK,CAAC;EAEvD,IAAIC,cAAc,IAAI,CAACP,aAAa,EAAE;IACpCA,aAAa,GAAG,IAAI;IACpBQ,OAAO,CAACC,IAAI,CACT,6KAA4KJ,SAAU,mQAAkQ,CAC1b;EACH;EAEA,IAAIE,cAAc,EAAE;IAClB,OAAOG,SAAS;EAClB;EAEA,MAAMC,UAAU,GAAGC,YAAG,CAACC,KAAK,CAACR,SAAS,CAAC,CAACS,QAAQ;;EAEhD;EACA,MAAM;IAAEC;EAAe,CAAC,GAAGT,KAAK,CAACU,QAAQ,EAAE;EAE3C,OAAOL,UAAU,GAAGI,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEE,GAAG,CAACN,UAAU,CAAC,GAAGD,SAAS;AACjE"}