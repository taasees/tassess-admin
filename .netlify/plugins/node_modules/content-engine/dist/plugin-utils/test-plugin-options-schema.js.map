{"version":3,"file":"test-plugin-options-schema.js","names":["testPluginOptionsSchema","pluginSchemaFunction","pluginOptions","pluginSchema","Joi","extend","joi","type","base","array","items","alternatives","string","object","resolve","options","unknown","custom","arrayValue","map","value","default","warning","validateOptionsSchema","warnings","details","detail","message","length","isValid","errors","hasWarnings","e"],"sources":["../../src/plugin-utils/test-plugin-options-schema.ts"],"sourcesContent":["import { Joi } from \"./joi\"\nimport { GatsbyNode } from \"../types\"\nimport { validateOptionsSchema } from \"./validate\"\nimport { IPluginInfoOptions } from \"./types\"\n\ninterface ITestPluginOptionsSchemaReturnType {\n  errors: Array<string>\n  warnings: Array<string>\n  isValid: boolean\n  hasWarnings: boolean\n}\n\nexport async function testPluginOptionsSchema(\n  pluginSchemaFunction: Exclude<GatsbyNode[\"pluginOptionsSchema\"], undefined>,\n  pluginOptions: IPluginInfoOptions\n): Promise<ITestPluginOptionsSchemaReturnType> {\n  const pluginSchema = pluginSchemaFunction({\n    Joi: Joi.extend(joi => {\n      return {\n        type: `subPlugins`,\n        base: joi\n          .array()\n          .items(\n            joi.alternatives(\n              joi.string(),\n              joi.object({\n                resolve: Joi.string(),\n                options: Joi.object({}).unknown(true),\n              })\n            )\n          )\n          .custom(\n            arrayValue =>\n              arrayValue.map(value => {\n                if (typeof value === `string`) {\n                  value = { resolve: value }\n                }\n\n                return value\n              }),\n            `Gatsby specific subplugin validation`\n          )\n          .default([]),\n      }\n    }),\n  })\n\n  try {\n    const { warning } = await validateOptionsSchema(pluginSchema, pluginOptions)\n\n    const warnings = warning?.details?.map(detail => detail.message) ?? []\n\n    if (warnings?.length > 0) {\n      return {\n        isValid: true,\n        errors: [],\n        hasWarnings: true,\n        warnings,\n      }\n    }\n  } catch (e) {\n    const errors = e?.details?.map(detail => detail.message) ?? []\n    return { isValid: false, errors, hasWarnings: false, warnings: [] }\n  }\n\n  return { isValid: true, errors: [], hasWarnings: false, warnings: [] }\n}\n"],"mappings":";;;;AAAA;AAEA;AAUO,eAAeA,uBAAuB,CAC3CC,oBAA2E,EAC3EC,aAAiC,EACY;EAC7C,MAAMC,YAAY,GAAGF,oBAAoB,CAAC;IACxCG,GAAG,EAAEA,QAAG,CAACC,MAAM,CAACC,GAAG,IAAI;MACrB,OAAO;QACLC,IAAI,EAAG,YAAW;QAClBC,IAAI,EAAEF,GAAG,CACNG,KAAK,EAAE,CACPC,KAAK,CACJJ,GAAG,CAACK,YAAY,CACdL,GAAG,CAACM,MAAM,EAAE,EACZN,GAAG,CAACO,MAAM,CAAC;UACTC,OAAO,EAAEV,QAAG,CAACQ,MAAM,EAAE;UACrBG,OAAO,EAAEX,QAAG,CAACS,MAAM,CAAC,CAAC,CAAC,CAAC,CAACG,OAAO,CAAC,IAAI;QACtC,CAAC,CAAC,CACH,CACF,CACAC,MAAM,CACLC,UAAU,IACRA,UAAU,CAACC,GAAG,CAACC,KAAK,IAAI;UACtB,IAAI,OAAOA,KAAK,KAAM,QAAO,EAAE;YAC7BA,KAAK,GAAG;cAAEN,OAAO,EAAEM;YAAM,CAAC;UAC5B;UAEA,OAAOA,KAAK;QACd,CAAC,CAAC,EACH,sCAAqC,CACvC,CACAC,OAAO,CAAC,EAAE;MACf,CAAC;IACH,CAAC;EACH,CAAC,CAAC;EAEF,IAAI;IAAA;IACF,MAAM;MAAEC;IAAQ,CAAC,GAAG,MAAM,IAAAC,+BAAqB,EAACpB,YAAY,EAAED,aAAa,CAAC;IAE5E,MAAMsB,QAAQ,2BAAGF,OAAO,aAAPA,OAAO,2CAAPA,OAAO,CAAEG,OAAO,qDAAhB,iBAAkBN,GAAG,CAACO,MAAM,IAAIA,MAAM,CAACC,OAAO,CAAC,uEAAI,EAAE;IAEtE,IAAI,CAAAH,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEI,MAAM,IAAG,CAAC,EAAE;MACxB,OAAO;QACLC,OAAO,EAAE,IAAI;QACbC,MAAM,EAAE,EAAE;QACVC,WAAW,EAAE,IAAI;QACjBP;MACF,CAAC;IACH;EACF,CAAC,CAAC,OAAOQ,CAAC,EAAE;IAAA;IACV,MAAMF,MAAM,qBAAGE,CAAC,aAADA,CAAC,qCAADA,CAAC,CAAEP,OAAO,+CAAV,WAAYN,GAAG,CAACO,MAAM,IAAIA,MAAM,CAACC,OAAO,CAAC,2DAAI,EAAE;IAC9D,OAAO;MAAEE,OAAO,EAAE,KAAK;MAAEC,MAAM;MAAEC,WAAW,EAAE,KAAK;MAAEP,QAAQ,EAAE;IAAG,CAAC;EACrE;EAEA,OAAO;IAAEK,OAAO,EAAE,IAAI;IAAEC,MAAM,EAAE,EAAE;IAAEC,WAAW,EAAE,KAAK;IAAEP,QAAQ,EAAE;EAAG,CAAC;AACxE"}